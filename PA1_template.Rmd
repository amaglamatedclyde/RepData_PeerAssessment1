---
title: "Reproducible Data: Peer Review Assignment 1"
author: "Clyde Tressler"
date: "November 5, 2015"
output: html_document
---
```{r global_options, echo=TRUE}
```
###Reading the Data
First we load the activity data. We use strings as character vectors to facilitate conversion to dates. 

```{r load_data}
setwd('~/RepData_PeerAssessment1')
dat <- read.csv('activity.csv', stringsAsFactors = FALSE)
dat$date <- as.Date(dat$date)
str(dat)
```
###Analysis of Raw Data
Below we group interval observations by day, then plot a histogram of steps by day and report the mean and median number of steps per day. NA observations are removed when summing the interval data. The dplyr library is used to group and summarize the intervals by date.
```{r, message=FALSE}
library(dplyr)
```

```{r plot_histogram_1}
date_grouped <- group_by(dat, date)
steps <- summarise_each(date_grouped, funs(sum(., na.rm = TRUE)), steps)
head(steps)
hist(steps$steps, main = 'Histogram of Steps per Day', xlab = 'Number of Steps', ylim=c(0,20), col='steelblue', breaks=10)
est_mean <- mean(steps$steps)
est_median <- median(steps$steps)
```

```{r report_mean_median}
est_mean
est_median
```

Next we group the data by 5-minute interval values in order to visualize the average steps per interval over all days in the observations. 

```{r plot_time_series}
interval_grouped <- group_by(dat, interval)
interval_steps <- summarise_each(interval_grouped, funs(mean(., na.rm = TRUE)), steps)
head(interval_steps)
tail(interval_steps)
plot(interval_steps$interval, interval_steps$steps, main = 'Number of Steps per 5-minute Interval', xlab = 'Interval', col='steelblue', type = 'l', ylab = 'Number of Steps', xlim=c(0,2500))
```

We verify the number of intervals observed and then identify the interval with the maximum number of steps:
```{r calc_max}
length(unique((dat$interval)))/12
subset(interval_steps, steps==max(steps))
```
Calculating the time of day for max steps, assuming interval 0 corresponds to 00:00hrs. This may not be true, but I'm curious
```{r calc_time}

835/60 #calculate hours
.91667*60 #calculate minutes from remainder
```

Time of day caluclated as 13:55. This is believable, but not proven.
Next we calculate the number of NA observations in the dataset:
```{r}
sum(is.na(dat$steps))
```
###Imputing Values for Missing Observations
Now we use vector recycling in R to quickly assign the step count means for each interval as a column in the original data frame, and then add another column to impute the missing values of the step observations by substituting the mean value when an NA is present in the original data.

```{r imputing_nas}
unique(dat$interval == interval_steps$interval) #check to see the intervals all match
dat$int_means <- interval_steps$steps
dat$imputed_steps <- ifelse(is.na(dat$steps), dat$int_means, dat$steps)
```
Let's make sure it worked:
```{r check_chunk}
head(dat)
tail(dat)
dat[14000:14015,] #looks right!
```

Now we repeat the analyses using the imputed data:
```{r plot_histogram_2}
date_grouped <- group_by(dat, date)
imputed_steps <- summarise_each(date_grouped, funs(sum(.)), imputed_steps)
head(imputed_steps)
hist(imputed_steps$imputed_steps, main = 'Histogram of Steps per Day', xlab = 'Number of Steps', ylim=c(0,25), col='steelblue', breaks=10)
mean(imputed_steps$imputed_steps)
median(imputed_steps$imputed_steps)
```

Are the values for the mean and median with the missing values filled-in the same as the previous calculations?
```{r examine_changes}
est_mean == mean(imputed_steps$imputed_steps)
est_median == median(imputed_steps$imputed_steps)
```
No, the values are different. In this case, replacing the missing data has resulted in step counts that seem to be more normally distributed around the mean.

###Weekday Activity vs Weekend Activity
Now we examine whether activity patterns are different on weekends versus weekdays. We add a factor variable and a day of week column to visually verify the factor.
```{r plot_day_of_week}
weekends <- c('Saturday', 'Sunday')
dat$dow <- weekdays(dat$date)
dat$day <- factor((weekdays(dat$date) %in% weekends), levels=c(TRUE, FALSE), labels=c('weekend', 'weekday'))
interval_grouped <- group_by(dat, interval, day)
interval_steps <- summarise_each(interval_grouped, funs(mean(.)), imputed_steps)
library(lattice)
xyplot(interval_steps$imputed_steps ~ interval_steps$interval | day, data=interval_steps, layout=c(1,2), main="Mean Steps for 5-Minute Intervals for Weekdays vs Weekends", xlab="Interval", ylab="Number of Steps", type=c("l","l"))
```

The Plots show that the weekday step count is highest earlier in the day and the weekend step count is more evenly distributed throughout the day.